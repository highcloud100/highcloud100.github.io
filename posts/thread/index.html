<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-233565867-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-233565867-1'); </script><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Thread" /><meta name="author" content="highcloud" /><meta property="og:locale" content="ko" /><meta name="description" content="PCB Consists PCB는 다음과 같이 c의 struct으로 만들어져 있다. 6개로 나눌 수 있다. task basic info files : 프로세스가 오픈한 파일들의 정보 fs : 접근중인 파일 정보 tty : 사용중인 터미널 정보 mm : 사용중인 메인 메모리 정보 signals PCB 구조체에서는 포인터를 이용해서 이들을 6조각으로 나누어 관리한다. 보통 포인터를 사용하는 것은 overhead 문제이다. Reduce PCB Overhead fork를 하는 과정에서 모든 PCB를 복사하는 것은 생각보다 오버헤드가 크다. read &amp; write files, fs, tty, mm, signals 정보는 부모와 다르게 사용되지 않는다. 어차피 같은 거면 포인터를 이용해 공유하자! Linux thread 위에서 thread가 사용되었다. thread는 무엇일까? 다음과 같이 PCB를 공유하는 자식이지만 모든 PCB를 복사하지 않는 프로세스 상태를 이야기한다. 이때는 clone 이라는 시스템 콜이 사용된다. 비트를 이용해 복사할 정보를 고를 수 있다. clone의 설명은 다음을 참고하자. man clone 여담으로 fork나 clone이나 do_fork로 작동된다 한다. http://rousalome.egloos.com/9984825 Image overhead PCB를 복사하는 것 말고도 이미지를 복사할 때 오버헤드가 발생한다. 왜 exec으로 코드를 밀어 버릴꺼면 굳이 fork를 사용할까? 이전에는 실제로 그냥 복사하고 밀었었다. 이를 막기위해 page table만 복사하기 시작했다. 그리고 만약 메모리에 write를 한다면 그제서야 그 페이지 부분만 copy 한다. 이를 copy on write라고 한다. 하지만 이 방법에는 문제가 있었다. 부모에서 자식으로 넘어가기전 어떤 작업 특히 write를 하게된다면 복사 이전의 메모리 정보가 달라지는 문제가 있다. 즉 자식은 이전 상태에서 복사 되었는데(실제 복사는 안됐지만 이론적으로) 자식이 메모리에 접근하기 전 부모에서 메모리를 수정함 그래서 이를 막기 위해 cow작업이 진행된다. 허나 자식은 대부분 exec을 진행하기에 의미가 없는 작업이 된다. 해결책 그래서 리눅스에서는 이를 해결하기 위해서 fork가 발생하면 바로 cpu를 자식이 먼저 실행되도록 넘겨버린다. 문제점 하지만! 현재는 리눅스에서 실행하면 부모가 먼저 실행된다. 직접 코딩해서 확인해보자. 이 부분에 대해 여러 글을 뒤졌지만 완벽한 이유를 찾지 못했다. 뭔가 바뀌긴 했다. https://stackoverflow.com/questions/8494732/who-executes-first-after-fork-parent-or-the-child 이 글의 마지막 답글을 보면 힌트가 있다. 아마도 기본적으로 부모가 실행되고 자식이 실행된다고 생각하기 때문에 이런 직관과 충돌하여 여러 오류를 내는 것 같다. https://karatus.tistory.com/m/189 관련해 정리가 잘된 블로그이다. 하지만 나는 정확한 이유는 이해하지 못했다. 리눅스 쓰레드 모델의 진화 아직은 완벽히 이해하지 못했으나 미래를 위해 삽질한 걸 남겨둔다. 쓰레드 탄생 프로세스는 운영체제가 설계될 당시 만들어졌지만 쓰레드는 한참 뒤에 만들어진다. 초기에는 작업의 단위가 프로세스 하나였다. 이후 cpu가 발전하며, 여러 코어를 가진 cpu가 멀티쓰레드를 지원하기 시작했다. 그래서 프로세스를 쪼개어 코어에 배분할 필요가 생겼다. 레벨 쓰레드는 유저레벨 쓰레드와 커널 레벨 쓰레드가 존재한다. 유저 레벨 운영체제가 멀티쓰레드를 지원하지 않을 때 사용함, 초기 쓰레드 시스템 라이브러리를 통해 구현됨 커널 쓰레드와 사용자 쓰레드가 1대 N으로 연결된다. 커널 레벨 커널이 멀티쓰레드를 지원함 1대 1로 연결된다. 멀티 레벨 M대 N으로 연결된다. Linux Thread history 다음 글을 읽어보자. https://dataonair.or.kr/db-tech-reference/d-lounge/technical-data/?mod=document&amp;uid=237711 https://en.wikipedia.org/wiki/Native_POSIX_Thread_Library 리눅스 버전 https://elixir.bootlin.com/ 2.6 버전으로 크게 바뀐 것 같다. 2.6.0 버전에는 남아있었다. 2.6.9.rc2 버전에서 사라졌다!" /><meta property="og:description" content="PCB Consists PCB는 다음과 같이 c의 struct으로 만들어져 있다. 6개로 나눌 수 있다. task basic info files : 프로세스가 오픈한 파일들의 정보 fs : 접근중인 파일 정보 tty : 사용중인 터미널 정보 mm : 사용중인 메인 메모리 정보 signals PCB 구조체에서는 포인터를 이용해서 이들을 6조각으로 나누어 관리한다. 보통 포인터를 사용하는 것은 overhead 문제이다. Reduce PCB Overhead fork를 하는 과정에서 모든 PCB를 복사하는 것은 생각보다 오버헤드가 크다. read &amp; write files, fs, tty, mm, signals 정보는 부모와 다르게 사용되지 않는다. 어차피 같은 거면 포인터를 이용해 공유하자! Linux thread 위에서 thread가 사용되었다. thread는 무엇일까? 다음과 같이 PCB를 공유하는 자식이지만 모든 PCB를 복사하지 않는 프로세스 상태를 이야기한다. 이때는 clone 이라는 시스템 콜이 사용된다. 비트를 이용해 복사할 정보를 고를 수 있다. clone의 설명은 다음을 참고하자. man clone 여담으로 fork나 clone이나 do_fork로 작동된다 한다. http://rousalome.egloos.com/9984825 Image overhead PCB를 복사하는 것 말고도 이미지를 복사할 때 오버헤드가 발생한다. 왜 exec으로 코드를 밀어 버릴꺼면 굳이 fork를 사용할까? 이전에는 실제로 그냥 복사하고 밀었었다. 이를 막기위해 page table만 복사하기 시작했다. 그리고 만약 메모리에 write를 한다면 그제서야 그 페이지 부분만 copy 한다. 이를 copy on write라고 한다. 하지만 이 방법에는 문제가 있었다. 부모에서 자식으로 넘어가기전 어떤 작업 특히 write를 하게된다면 복사 이전의 메모리 정보가 달라지는 문제가 있다. 즉 자식은 이전 상태에서 복사 되었는데(실제 복사는 안됐지만 이론적으로) 자식이 메모리에 접근하기 전 부모에서 메모리를 수정함 그래서 이를 막기 위해 cow작업이 진행된다. 허나 자식은 대부분 exec을 진행하기에 의미가 없는 작업이 된다. 해결책 그래서 리눅스에서는 이를 해결하기 위해서 fork가 발생하면 바로 cpu를 자식이 먼저 실행되도록 넘겨버린다. 문제점 하지만! 현재는 리눅스에서 실행하면 부모가 먼저 실행된다. 직접 코딩해서 확인해보자. 이 부분에 대해 여러 글을 뒤졌지만 완벽한 이유를 찾지 못했다. 뭔가 바뀌긴 했다. https://stackoverflow.com/questions/8494732/who-executes-first-after-fork-parent-or-the-child 이 글의 마지막 답글을 보면 힌트가 있다. 아마도 기본적으로 부모가 실행되고 자식이 실행된다고 생각하기 때문에 이런 직관과 충돌하여 여러 오류를 내는 것 같다. https://karatus.tistory.com/m/189 관련해 정리가 잘된 블로그이다. 하지만 나는 정확한 이유는 이해하지 못했다. 리눅스 쓰레드 모델의 진화 아직은 완벽히 이해하지 못했으나 미래를 위해 삽질한 걸 남겨둔다. 쓰레드 탄생 프로세스는 운영체제가 설계될 당시 만들어졌지만 쓰레드는 한참 뒤에 만들어진다. 초기에는 작업의 단위가 프로세스 하나였다. 이후 cpu가 발전하며, 여러 코어를 가진 cpu가 멀티쓰레드를 지원하기 시작했다. 그래서 프로세스를 쪼개어 코어에 배분할 필요가 생겼다. 레벨 쓰레드는 유저레벨 쓰레드와 커널 레벨 쓰레드가 존재한다. 유저 레벨 운영체제가 멀티쓰레드를 지원하지 않을 때 사용함, 초기 쓰레드 시스템 라이브러리를 통해 구현됨 커널 쓰레드와 사용자 쓰레드가 1대 N으로 연결된다. 커널 레벨 커널이 멀티쓰레드를 지원함 1대 1로 연결된다. 멀티 레벨 M대 N으로 연결된다. Linux Thread history 다음 글을 읽어보자. https://dataonair.or.kr/db-tech-reference/d-lounge/technical-data/?mod=document&amp;uid=237711 https://en.wikipedia.org/wiki/Native_POSIX_Thread_Library 리눅스 버전 https://elixir.bootlin.com/ 2.6 버전으로 크게 바뀐 것 같다. 2.6.0 버전에는 남아있었다. 2.6.9.rc2 버전에서 사라졌다!" /><link rel="canonical" href="https://highcloud100.github.io/posts/thread/" /><meta property="og:url" content="https://highcloud100.github.io/posts/thread/" /><meta property="og:site_name" content="highcloud100" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-12T22:55:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Thread" /><meta name="twitter:site" content="@highcloud100" /><meta name="twitter:creator" content="@highcloud" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"highcloud"},"dateModified":"2022-07-12T22:55:00+09:00","datePublished":"2022-07-12T22:55:00+09:00","description":"PCB Consists PCB는 다음과 같이 c의 struct으로 만들어져 있다. 6개로 나눌 수 있다. task basic info files : 프로세스가 오픈한 파일들의 정보 fs : 접근중인 파일 정보 tty : 사용중인 터미널 정보 mm : 사용중인 메인 메모리 정보 signals PCB 구조체에서는 포인터를 이용해서 이들을 6조각으로 나누어 관리한다. 보통 포인터를 사용하는 것은 overhead 문제이다. Reduce PCB Overhead fork를 하는 과정에서 모든 PCB를 복사하는 것은 생각보다 오버헤드가 크다. read &amp; write files, fs, tty, mm, signals 정보는 부모와 다르게 사용되지 않는다. 어차피 같은 거면 포인터를 이용해 공유하자! Linux thread 위에서 thread가 사용되었다. thread는 무엇일까? 다음과 같이 PCB를 공유하는 자식이지만 모든 PCB를 복사하지 않는 프로세스 상태를 이야기한다. 이때는 clone 이라는 시스템 콜이 사용된다. 비트를 이용해 복사할 정보를 고를 수 있다. clone의 설명은 다음을 참고하자. man clone 여담으로 fork나 clone이나 do_fork로 작동된다 한다. http://rousalome.egloos.com/9984825 Image overhead PCB를 복사하는 것 말고도 이미지를 복사할 때 오버헤드가 발생한다. 왜 exec으로 코드를 밀어 버릴꺼면 굳이 fork를 사용할까? 이전에는 실제로 그냥 복사하고 밀었었다. 이를 막기위해 page table만 복사하기 시작했다. 그리고 만약 메모리에 write를 한다면 그제서야 그 페이지 부분만 copy 한다. 이를 copy on write라고 한다. 하지만 이 방법에는 문제가 있었다. 부모에서 자식으로 넘어가기전 어떤 작업 특히 write를 하게된다면 복사 이전의 메모리 정보가 달라지는 문제가 있다. 즉 자식은 이전 상태에서 복사 되었는데(실제 복사는 안됐지만 이론적으로) 자식이 메모리에 접근하기 전 부모에서 메모리를 수정함 그래서 이를 막기 위해 cow작업이 진행된다. 허나 자식은 대부분 exec을 진행하기에 의미가 없는 작업이 된다. 해결책 그래서 리눅스에서는 이를 해결하기 위해서 fork가 발생하면 바로 cpu를 자식이 먼저 실행되도록 넘겨버린다. 문제점 하지만! 현재는 리눅스에서 실행하면 부모가 먼저 실행된다. 직접 코딩해서 확인해보자. 이 부분에 대해 여러 글을 뒤졌지만 완벽한 이유를 찾지 못했다. 뭔가 바뀌긴 했다. https://stackoverflow.com/questions/8494732/who-executes-first-after-fork-parent-or-the-child 이 글의 마지막 답글을 보면 힌트가 있다. 아마도 기본적으로 부모가 실행되고 자식이 실행된다고 생각하기 때문에 이런 직관과 충돌하여 여러 오류를 내는 것 같다. https://karatus.tistory.com/m/189 관련해 정리가 잘된 블로그이다. 하지만 나는 정확한 이유는 이해하지 못했다. 리눅스 쓰레드 모델의 진화 아직은 완벽히 이해하지 못했으나 미래를 위해 삽질한 걸 남겨둔다. 쓰레드 탄생 프로세스는 운영체제가 설계될 당시 만들어졌지만 쓰레드는 한참 뒤에 만들어진다. 초기에는 작업의 단위가 프로세스 하나였다. 이후 cpu가 발전하며, 여러 코어를 가진 cpu가 멀티쓰레드를 지원하기 시작했다. 그래서 프로세스를 쪼개어 코어에 배분할 필요가 생겼다. 레벨 쓰레드는 유저레벨 쓰레드와 커널 레벨 쓰레드가 존재한다. 유저 레벨 운영체제가 멀티쓰레드를 지원하지 않을 때 사용함, 초기 쓰레드 시스템 라이브러리를 통해 구현됨 커널 쓰레드와 사용자 쓰레드가 1대 N으로 연결된다. 커널 레벨 커널이 멀티쓰레드를 지원함 1대 1로 연결된다. 멀티 레벨 M대 N으로 연결된다. Linux Thread history 다음 글을 읽어보자. https://dataonair.or.kr/db-tech-reference/d-lounge/technical-data/?mod=document&amp;uid=237711 https://en.wikipedia.org/wiki/Native_POSIX_Thread_Library 리눅스 버전 https://elixir.bootlin.com/ 2.6 버전으로 크게 바뀐 것 같다. 2.6.0 버전에는 남아있었다. 2.6.9.rc2 버전에서 사라졌다!","headline":"Thread","mainEntityOfPage":{"@type":"WebPage","@id":"https://highcloud100.github.io/posts/thread/"},"url":"https://highcloud100.github.io/posts/thread/"}</script><title>Thread | highcloud100</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="highcloud100"><meta name="application-name" content="highcloud100"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/80192345?v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">highcloud100</a></div><div class="site-subtitle font-italic">One of the comforting things about old memories is their tendency to take on a rosy glow.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/highcloud100" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/highcloud100" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['highcloud100','inha.edu'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Thread</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Thread</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1657634100" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 12, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> baekbumsung </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1193 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><h1 id="pcb">PCB</h1><hr /><h2 id="consists"><span class="mr-2">Consists</span><a href="#consists" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><p><img data-src="https://user-images.githubusercontent.com/80192345/178372870-0d3664b4-34e4-4e66-88b2-8d5f64fbecd6.png" alt="" data-proofer-ignore><br /> <img data-src="https://user-images.githubusercontent.com/80192345/178373032-e74f12f7-da35-41a4-ad40-36268e804073.png" alt="" data-proofer-ignore></p><ul><li><p>PCB는 다음과 같이 c의 struct으로 만들어져 있다.</p><li><p>6개로 나눌 수 있다.</p><ol><li>task basic info<li>files : 프로세스가 오픈한 파일들의 정보<li>fs : 접근중인 파일 정보<li>tty : 사용중인 터미널 정보<li>mm : 사용중인 메인 메모리 정보<li>signals</ol><li><p>PCB 구조체에서는 포인터를 이용해서 이들을 6조각으로 나누어 관리한다.</p></ul><blockquote><p>보통 포인터를 사용하는 것은 overhead 문제이다.</p></blockquote><h2 id="reduce-pcb-overhead"><span class="mr-2">Reduce PCB Overhead</span><a href="#reduce-pcb-overhead" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><p><img data-src="https://user-images.githubusercontent.com/80192345/178428900-7f279010-ca7b-4294-9724-774d8424cd3e.png" alt="" data-proofer-ignore></p><ul><li>fork를 하는 과정에서 모든 PCB를 복사하는 것은 생각보다 오버헤드가 크다.</ul><blockquote><p>read &amp; write</p></blockquote><ul><li>files, fs, tty, mm, signals 정보는 부모와 다르게 사용되지 않는다.<ul><li>어차피 같은 거면 포인터를 이용해 공유하자!</ul></ul><p><img data-src="https://user-images.githubusercontent.com/80192345/178430087-d4740c9f-17b6-48bf-8c5e-6e82ee3d929a.png" alt="" data-proofer-ignore></p><h1 id="linux-thread">Linux thread</h1><hr /><ul><li>위에서 thread가 사용되었다. thread는 무엇일까?</ul><p><img data-src="https://user-images.githubusercontent.com/80192345/178430608-0e748d07-f0d9-4fbf-bcaf-465817402b7a.png" alt="" data-proofer-ignore></p><ul><li>다음과 같이 PCB를 공유하는 자식이지만 모든 PCB를 복사하지 않는 프로세스 상태를 이야기한다.<ul><li>이때는 clone 이라는 시스템 콜이 사용된다.</ul></ul><p><img data-src="https://user-images.githubusercontent.com/80192345/178430779-52d2a23c-36dd-4c7c-8f10-5ca00ab7353c.png" alt="" data-proofer-ignore></p><ul><li>비트를 이용해 복사할 정보를 고를 수 있다.<li>clone의 설명은 다음을 참고하자. man clone</ul><p><img data-src="https://user-images.githubusercontent.com/80192345/178431083-78a0c99f-3362-471a-a383-7495064764da.png" alt="" data-proofer-ignore></p><blockquote><p>여담으로 fork나 clone이나 do_fork로 작동된다 한다.<br /> <a href="http://rousalome.egloos.com/9984825">http://rousalome.egloos.com/9984825</a></p></blockquote><p><img data-src="https://user-images.githubusercontent.com/80192345/178432063-e5d2b95c-676a-4cef-84d3-cf31186d0df8.png" alt="" data-proofer-ignore></p><h1 id="image-overhead">Image overhead</h1><hr /><ul><li><p>PCB를 복사하는 것 말고도 이미지를 복사할 때 오버헤드가 발생한다.</p><li><p>왜 exec으로 코드를 밀어 버릴꺼면 굳이 fork를 사용할까?</p></ul><p><img data-src="https://user-images.githubusercontent.com/80192345/178479607-bc170513-2795-40d3-b712-e36bc5733cd8.png" alt="" data-proofer-ignore></p><ul><li>이전에는 실제로 그냥 복사하고 밀었었다.</ul><p><img data-src="https://user-images.githubusercontent.com/80192345/178479715-5f932b20-f023-4ab1-b202-d2f83339a18c.png" alt="" data-proofer-ignore></p><ul><li><p>이를 막기위해 page table만 복사하기 시작했다.</p><li><p>그리고 만약 메모리에 write를 한다면 그제서야 그 페이지 부분만 copy 한다.</p><ul><li>이를 copy on write라고 한다.</ul><li><p>하지만 이 방법에는 문제가 있었다.</p><li><p>부모에서 자식으로 넘어가기전 어떤 작업 특히 write를 하게된다면 복사 이전의 메모리 정보가 달라지는 문제가 있다.</p><ul><li>즉 자식은 이전 상태에서 복사 되었는데(실제 복사는 안됐지만 이론적으로) 자식이 메모리에 접근하기 전 부모에서 메모리를 수정함</ul><li><p>그래서 이를 막기 위해 cow작업이 진행된다.</p><ul><li>허나 자식은 대부분 exec을 진행하기에 의미가 없는 작업이 된다.</ul></ul><p><img data-src="https://user-images.githubusercontent.com/80192345/178480858-1e3ee25a-fb47-43aa-964d-559efe4c6863.png" alt="" data-proofer-ignore></p><h2 id="해결책"><span class="mr-2">해결책</span><a href="#해결책" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><ul><li>그래서 리눅스에서는 이를 해결하기 위해서 fork가 발생하면 바로 cpu를 자식이 먼저 실행되도록 넘겨버린다.</ul><p><img data-src="https://user-images.githubusercontent.com/80192345/178481057-a5853664-9c57-4bd4-a63d-679fa8cac9c5.png" alt="" data-proofer-ignore><br /> <img data-src="https://user-images.githubusercontent.com/80192345/178481195-058eed81-e7b9-4990-99c3-d842a6c9f68c.png" alt="" data-proofer-ignore></p><h2 id="문제점"><span class="mr-2">문제점</span><a href="#문제점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><ul><li><p>하지만! 현재는 리눅스에서 실행하면 부모가 먼저 실행된다.</p><ul><li>직접 코딩해서 확인해보자.</ul><li><p>이 부분에 대해 여러 글을 뒤졌지만 완벽한 이유를 찾지 못했다. 뭔가 바뀌긴 했다.</p><ul><li><a href="https://stackoverflow.com/questions/8494732/who-executes-first-after-fork-parent-or-the-child">https://stackoverflow.com/questions/8494732/who-executes-first-after-fork-parent-or-the-child</a><li>이 글의 마지막 답글을 보면 힌트가 있다.<li>아마도 기본적으로 부모가 실행되고 자식이 실행된다고 생각하기 때문에 이런 직관과 충돌하여 여러 오류를 내는 것 같다.</ul><li><p><a href="https://karatus.tistory.com/m/189">https://karatus.tistory.com/m/189</a></p><ul><li>관련해 정리가 잘된 블로그이다. 하지만 나는 정확한 이유는 이해하지 못했다.</ul></ul><h2 id="리눅스-쓰레드-모델의-진화"><span class="mr-2">리눅스 쓰레드 모델의 진화</span><a href="#리눅스-쓰레드-모델의-진화" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><blockquote><p>아직은 완벽히 이해하지 못했으나 미래를 위해 삽질한 걸 남겨둔다.</p></blockquote><h3 id="쓰레드-탄생"><span class="mr-2">쓰레드 탄생</span><a href="#쓰레드-탄생" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><hr /><ul><li>프로세스는 운영체제가 설계될 당시 만들어졌지만 쓰레드는 한참 뒤에 만들어진다.<li>초기에는 작업의 단위가 프로세스 하나였다.<li>이후 cpu가 발전하며, 여러 코어를 가진 cpu가 멀티쓰레드를 지원하기 시작했다.<li>그래서 프로세스를 쪼개어 코어에 배분할 필요가 생겼다.</ul><h3 id="레벨"><span class="mr-2">레벨</span><a href="#레벨" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><hr /><ul><li>쓰레드는 유저레벨 쓰레드와 커널 레벨 쓰레드가 존재한다.</ul><h4 id="유저-레벨"><span class="mr-2">유저 레벨</span><a href="#유저-레벨" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>운영체제가 멀티쓰레드를 지원하지 않을 때 사용함, 초기 쓰레드 시스템<li>라이브러리를 통해 구현됨<li>커널 쓰레드와 사용자 쓰레드가 1대 N으로 연결된다.</ul><h4 id="커널-레벨"><span class="mr-2">커널 레벨</span><a href="#커널-레벨" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>커널이 멀티쓰레드를 지원함<li>1대 1로 연결된다.</ul><h4 id="멀티-레벨"><span class="mr-2">멀티 레벨</span><a href="#멀티-레벨" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>M대 N으로 연결된다.</ul><h3 id="linux-thread-history"><span class="mr-2">Linux Thread history</span><a href="#linux-thread-history" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><hr /><ul><li>다음 글을 읽어보자.<ul><li><a href="https://dataonair.or.kr/db-tech-reference/d-lounge/technical-data/?mod=document&amp;uid=237711">https://dataonair.or.kr/db-tech-reference/d-lounge/technical-data/?mod=document&amp;uid=237711</a><li><a href="https://en.wikipedia.org/wiki/Native_POSIX_Thread_Library">https://en.wikipedia.org/wiki/Native_POSIX_Thread_Library</a></ul></ul><h3 id="리눅스-버전-httpselixir.bootlin.com"><span class="mr-2">리눅스 버전 <a href="https://elixir.bootlin.com/"><span class="mr-2">https://elixir.bootlin.com/</a></span><a href="#리눅스-버전-httpselixir.bootlin.com" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><hr /><ul><li>2.6 버전으로 크게 바뀐 것 같다.<li>2.6.0 버전에는 남아있었다.</ul><p><img data-src="https://user-images.githubusercontent.com/80192345/178507045-8f3b141b-a8d2-425c-8d20-d488252139ae.png" alt="" data-proofer-ignore></p><ul><li>2.6.9.rc2 버전에서 사라졌다!</ul><p><img data-src="https://user-images.githubusercontent.com/80192345/178507153-52992edc-6ef0-472d-aa22-cc22e1dad571.png" alt="" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cs/'>CS</a>, <a href='/categories/os/'>OS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/os/" class="post-tag no-text-decoration" >os</a> <a href="/tags/cs/" class="post-tag no-text-decoration" >cs</a> <a href="/tags/summer/" class="post-tag no-text-decoration" >summer</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Thread+-+highcloud100&url=https%3A%2F%2Fhighcloud100.github.io%2Fposts%2Fthread%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Thread+-+highcloud100&u=https%3A%2F%2Fhighcloud100.github.io%2Fposts%2Fthread%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fhighcloud100.github.io%2Fposts%2Fthread%2F&text=Thread+-+highcloud100" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div><script src="https://utteranc.es/client.js" repo="highcloud100/blog-utterances" issue-term="pathname" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/xv6%EB%B0%B1%EC%97%85/">xv6 백업</a><li><a href="/posts/gpuServerSetting/">gpu 서버 세팅</a><li><a href="/posts/winter/">2023 Winter Vacation</a><li><a href="/posts/%EB%85%B8%ED%8A%B8%EB%B6%81-%EC%84%B8%ED%8C%85/">노트북 세팅</a><li><a href="/posts/plan240508/">추후 계획과 현 상황?</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/summer/">summer</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/ml/">ML</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/distributed-systems/">Distributed_Systems</a> <a class="post-tag" href="/tags/tcp/">tcp</a> <a class="post-tag" href="/tags/%EC%8B%A4%EC%8A%B5%EA%B3%BC-%EA%B7%B8%EB%A6%BC%EC%9C%BC%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%A6%AC%EB%88%85%EC%8A%A4-%EA%B5%AC%EC%A1%B0/">실습과 그림으로 배우는 리눅스 구조</a> <a class="post-tag" href="/tags/life/">life</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/start/"><div class="card-body"> <em class="small" data-ts="1656982800" data-df="ll" > Jul 5, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>운영체제 공부 정리</h3><div class="text-muted small"><p> 운영체제 공부 정리 2학년 여름 방학 운영체제에 대해 공부하려 한다. 7월 20일까지 공부 계획 중… 공부 자료 / 출처 OS쉽게 배우는 운영체제 조성호널널한 개발자 - 운영체제 강의Kernel of linux 고건 교수님실습과 그림으로 배우는 리눅스 구조</p></div></div></a></div><div class="card"> <a href="/posts/intro/"><div class="card-body"> <em class="small" data-ts="1656988740" data-df="ll" > Jul 5, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>intro of OS</h3><div class="text-muted small"><p> OS 운영체제는 사용자와 컴퓨터 사이에서 하드웨어 사이에서 작동하는 시스템이다. 운영체제의 목표는 다음과 같다. OS자원관리자원 보호하드웨어 인터페이스사용자 인터페이스효휼성안정성확장성편리성 Performance Throughput — jobs/sec Utilization — % of time busy Response time — sec / j...</p></div></div></a></div><div class="card"> <a href="/posts/systemcall/"><div class="card-body"> <em class="small" data-ts="1656999000" data-df="ll" > Jul 5, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>System Call</h3><div class="text-muted small"><p> SystemCall system call은 커널에게 I/O 작업을 요청하는 것이다. 하드웨어의 mode bit 를 사용하여 커널모드와 유저모드로 나눈다. cpu의 mode bit 가 0이면 kernel mode 이며, cpu는 어떤 메모리의 영역이든 접근할 수 있다. mode bit이 1이면 user mode로 cpu는 파일에 영향을 주는 명령...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/back/" class="btn btn-outline-primary" prompt="Older"><p>Backpropagation</p></a> <a href="/posts/optimization/" class="btn btn-outline-primary" prompt="Newer"><p>Optimization</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/highcloud100">baekbumsung</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/summer/">summer</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/ml/">ML</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/distributed-systems/">Distributed_Systems</a> <a class="post-tag" href="/tags/tcp/">tcp</a> <a class="post-tag" href="/tags/%EC%8B%A4%EC%8A%B5%EA%B3%BC-%EA%B7%B8%EB%A6%BC%EC%9C%BC%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%A6%AC%EB%88%85%EC%8A%A4-%EA%B5%AC%EC%A1%B0/">실습과 그림으로 배우는 리눅스 구조</a> <a class="post-tag" href="/tags/life/">life</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-233565867-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-233565867-1'); </script>
